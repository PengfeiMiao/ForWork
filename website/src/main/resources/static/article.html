<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>文章管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./layui/css/layui.css">
    <script src="./js/jquery.min.js"></script>
    <script src="./layui/layui.js"></script>
    <script src="./js/axios.min.js"></script>
    <script src="./js/config.js"></script>
    <style>
        .layui-table-cell {
            height: auto;
            /*line-height: 28px;*/
        }
    </style>
</head>
<body style="min-height: 600px">
<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <!--                <div class="layui-card-header">标题</div>-->
                <div class="layui-card-body">
                    <div class="demoTable">
                        <div class="layui-inline">
                            <input class="layui-input" name="id" id="demoReload" autocomplete="off">
                        </div>
                        <button class="layui-btn" data-type="reload" id="reload">搜索</button>
                    </div>
                    <table class="layui-hide" id="test"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="titleTpl">
    <div class="layui-col-md12">
        <div class="layui-card">
            <div class="layui-card-body">
                <div>{{d.title}}</div>
                <div>{{d.intro}}</div>
                <div>
                    <p style="display:block; float:left;">{{d.createTime}}</p>
                    <p style="display:block; float:left; margin-left: 20px; width: 20px">{{d.visit}}</p>
                    <p style="display:block; float:left; margin-left: 20px; width: 20px">{{d.star}}</p>
                    <p style="display:block; float:left; margin-left: 20px; width: 20px">{{d.comment}}</p>
                    <a style="display:inline; margin-left: 50%" href="detail.html?id={{d.id}}">浏览</a>
                    <a style="display:inline; margin-left: 50px" href="editor.html?id={{d.id}}">编辑</a>
                </div>
            </div>
        </div>
    </div>
</script>

<script>

    var data = {
        "page": 0,
        "pageSize": 10
    };

    layui.use('table', function () {
        var table = layui.table;
        axios.post(baseUrl + "/article/list", data)
            .then(res => {
                console.log('data', res.data);
                if (res.data.status === 200) {
                    let articles = res.data.data.list;
                    table.render({
                        id: 'testReload'
                        , elem: '#test'
                        , data: articles
                        , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                        , cols: [[
                            {field: 'id', title: 'ID', width: '5%'},
                            {field: 'title', title: '文章列表', width: '95%', templet: '#titleTpl'} //这里的templet值是模板元素的选择器
                        ]],
                        page: true
                    });
                }
            })

        // 刷新按钮点击事件
        $('#reload').on('click', function () {
            axios.post(baseUrl + "/article/list", data)
                .then(res => {
                    console.log('data', res.data);
                    if (res.data.status === 200) {
                        let articles = res.data.data.list;
                        table.reload('testReload', {
                            page: {
                                curr: 1 //重新从第 1 页开始
                            },
                            data: articles
                            // , where: {
                            //     key: {
                            //         id: demoReload.val()
                            //     }
                            // }
                        }, 'data');
                    }
                })
        })
    });
</script>
</body>
</html>